package layouts

import "github.com/vovanwin/template/internal/controller/ui/components"

// AuthedLayout ‚Äî –ª–µ–π–∞—É—Ç –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
// title ‚Äî –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, activeURL ‚Äî —Ç–µ–∫—É—â–∏–π –ø—É—Ç—å (–¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –º–µ–Ω—é),
// content ‚Äî –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –æ—Å–Ω–æ–≤–Ω—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º, csrfToken ‚Äî —Ç–æ–∫–µ–Ω CSRF.
templ AuthedLayout(title string, activeURL string, content templ.Component, csrfToken string) {
	<!DOCTYPE html>
	<html lang="ru">
		<head>
			<meta charset="UTF-8"/>
			<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
			<title>{ title } ‚Äî Template App</title>
			<!-- HTMX -->
			<script src="https://unpkg.com/htmx.org@1.9.10"></script>
			<script src="https://unpkg.com/htmx.org/dist/ext/sse.js"></script>
			<script src="https://unpkg.com/htmx.org/dist/ext/json-enc.js"></script>
			<!-- Tailwind CSS -->
			<script src="https://cdn.tailwindcss.com"></script>
			<meta name="csrf-token" content={ csrfToken }/>
		</head>
		<body class="bg-gray-100 font-sans">
			<!-- hx-boost –Ω–∞ –æ–±—ë—Ä—Ç–∫–µ: HTMX –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —Å—Å—ã–ª–∫–∏ –≤–Ω—É—Ç—Ä–∏ -->
			<div hx-boost="true" class="flex h-screen overflow-hidden">
				<!-- –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é -->
				@components.SideMenu(components.DefaultMenuItems(), activeURL)
				<!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å -->
				<div class="flex-1 flex flex-col min-h-screen overflow-auto">
					<!-- –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å -->
					<header class="bg-white shadow-sm px-6 py-4 flex items-center justify-between shrink-0">
						<h1 class="text-lg font-semibold text-gray-800">{ title }</h1>
						<div class="flex items-center gap-4">
							<a href="/profile" class="text-sm text-gray-600 hover:text-indigo-600 transition-colors">
								üë§ –ü—Ä–æ—Ñ–∏–ª—å
							</a>
							<a href="/logout" class="text-sm text-red-500 hover:text-red-700 transition-colors">
								–í—ã–π—Ç–∏
							</a>
						</div>
					</header>
					<!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
					<main class="flex-1 p-6 overflow-auto">
						@content
					</main>
				</div>
			</div>
			<!-- SSE-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: hx-preserve ‚Äî –Ω–µ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
			<div id="notifications" class="fixed bottom-4 right-4 z-50 flex flex-col space-y-2 max-w-sm">
				<div
					id="sse-container"
					hx-preserve="true"
					hx-ext="sse"
					sse-connect="/api/v1/events"
					sse-swap="message"
				></div>
			</div>
			<script>
				// CSRF –≤–æ –≤—Å–µ HTMX-–∑–∞–ø—Ä–æ—Å—ã
				document.addEventListener('htmx:configRequest', (event) => {
					const meta = document.querySelector('meta[name="csrf-token"]');
					if (meta) event.detail.headers['X-CSRF-Token'] = meta.content;
				});

				// –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
				document.addEventListener('htmx:responseError', (event) => {
					const msg = event.detail.xhr.responseText || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞';
					const target = event.detail.target;
					if (target) {
						target.innerHTML = `<div class="text-red-600 bg-red-50 p-3 rounded-lg border border-red-200">‚ùå ${msg}</div>`;
					}
				});
			</script>
		</body>
	</html>
}
