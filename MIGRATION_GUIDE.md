# –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ —Å–µ—Å—Å–∏–∏ - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

## üìã –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **users** - —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å argon2id —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º –ø–∞—Ä–æ–ª–µ–π  
- **sessions** - —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π –≤ PostgreSQL

### 2. –°–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ PostgreSQL  
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ —á–µ—Ä–µ–∑ `scs` —Å `postgresstore`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Å–µ—Å—Å–∏–π
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –Ω–∞ Redis

### 3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- Repository pattern –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- Service layer —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö  
- Web-–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –Ω–∞—Å—Ç–æ—è—â—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

## üöÄ –ó–∞–ø—É—Å–∫

### 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL
```bash
cd deployments/local
docker-compose up -d postgres
```

### 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
```bash
cd app
go run . migration up
```

### 3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```bash
go run .
```

## üîê –¢–µ—Å—Ç–æ–≤—ã–µ –∞–∫–∫–∞—É–Ω—Ç—ã

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π –¥–æ—Å—Ç—É–ø–Ω—ã:

- **admin@example.com** / `password`
- **user@example.com** / `123456`

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Å—Å–∏–π

–í `config/config.yml`:

```yaml
sessions:
  store: postgres      # postgres, redis, memory
  lifetime: 24h        # –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Å–µ—Å—Å–∏–π
  # redis_addr: localhost:6379    # –¥–ª—è Redis
  # redis_password: ""
  # redis_db: 0
```

## üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ Redis

1. –î–æ–±–∞–≤—å—Ç–µ –≤ `go.mod`:
```bash
go get github.com/alexedwards/scs/redisstore
```

2. –û–±–Ω–æ–≤–∏—Ç–µ `pkg/sessions/session_provider.go`:
```go
case Redis:
    // –†–µ–∞–ª–∏–∑—É–π—Ç–µ Redis store
    redisPool := &redis.Pool{...}
    store := redisstore.New(redisPool)
    sessionManager.Store = store
```

3. –ò–∑–º–µ–Ω–∏—Ç–µ –≤ –∫–æ–Ω—Ñ–∏–≥–µ:
```yaml
sessions:
  store: redis
  redis_addr: localhost:6379
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
app/
‚îú‚îÄ‚îÄ db/migrations/
‚îÇ   ‚îú‚îÄ‚îÄ 20241225000001_create_users_table.sql
‚îÇ   ‚îî‚îÄ‚îÄ 20241225000002_create_sessions_table.sql
‚îú‚îÄ‚îÄ internal/module/users/repository/
‚îÇ   ‚îî‚îÄ‚îÄ users_repository.go
‚îú‚îÄ‚îÄ pkg/sessions/
‚îÇ   ‚îî‚îÄ‚îÄ session_provider.go
‚îî‚îÄ‚îÄ config/config.yml (–æ–±–Ω–æ–≤–ª–µ–Ω)
```

## üîç –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ –°–µ—Å—Å–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ PostgreSQL
- ‚úÖ –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Å–µ—Å—Å–∏–π
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (argon2id)
- ‚úÖ Repository pattern –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ Web-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ HTMX
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–π –≤—ã–±–æ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å–µ—Å—Å–∏–π

## üõ† –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π
```bash
go run . migration down
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–µ—Å—Å–∏–π –≤ –ë–î
```sql
SELECT token, expiry FROM sessions;
```

### –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–µ–∫—à–∏—Ö —Å–µ—Å—Å–∏–π –≤—Ä—É—á–Ω—É—é
```sql
SELECT cleanup_expired_sessions();
```
